# 0 指针

<font style="color:rgb(68, 68, 68);">指针（pointer）在Go语言中可以被拆分为两个核心概念：</font>

+ <font style="color:#D46B08;">类型指针</font><font style="color:rgb(68, 68, 68);">，允许对这个指针类型的数据进行修改，传递数据可以直接使用指针，而无须拷贝数据，类型指针不能进行偏移和运算。</font>
+ <font style="color:#D46B08;">切片</font><font style="color:rgb(68, 68, 68);">，由指向起始元素的原始指针、元素数量和容量组成。</font>

  
<font style="color:rgb(68, 68, 68);">受益于这样的约束和拆分，Go语言的指针类型变量即拥有指针高效访问的特点，又不会发生指针偏移，从而避免了非法修改关键性数据的问题。同时，垃圾回收也比较容易对不会发生偏移的指针进行检索和回收。</font>  


<font style="color:rgb(68, 68, 68);">切片比原始指针具备更强大的特性，而且更为安全。切片在发生越界时，运行时会报出宕机，并打出堆栈，而原始指针只会崩溃。</font>

<font style="color:rgb(68, 68, 68);"></font>

<font style="color:rgb(68, 68, 68);">一个指针变量可以指向任何一个值的内存地址，它所指向的值的内存地址在 32 和 64 位机器上分别占用 4 或 8 个字节，占用字节的大小与所指向的值的大小无关。</font><font style="color:#D46B08;">当一个指针被定义后没有分配到任何变量时，它的默认值为 nil。</font><font style="color:rgb(68, 68, 68);">指针变量通常缩写为 ptr。</font>  
  
<font style="color:rgb(68, 68, 68);">每个变量在运行时都拥有一个地址，这个地址代表变量在内存中的位置。Go语言中使用在变量名前面添加</font><font style="color:rgb(51, 51, 51);background-color:rgb(246, 246, 246);">&</font><font style="color:rgb(68, 68, 68);">操作符（前缀）来获取变量的内存地址（取地址操作），格式如下：</font>

```go
ptr := &v    // v 的类型为 T
```

<font style="color:rgb(68, 68, 68);">其中 v 代表被取地址的变量，变量 v 的地址使用变量 ptr 进行接收，ptr 的类型为</font><font style="color:rgb(51, 51, 51);background-color:rgb(246, 246, 246);">*T</font><font style="color:rgb(68, 68, 68);">，称做 T 的指针类型，</font><font style="color:rgb(51, 51, 51);background-color:rgb(246, 246, 246);">*</font><font style="color:rgb(68, 68, 68);">代表指针。</font>

```go
package main
import (
    "fmt"
)
func main() {
    var cat int = 1
    var str string = "banana"
    fmt.Printf("%p %p", &cat, &str)
}
```

运行结果：

```go
0xc042052088 0xc0420461b0
```

### 实例练习
```go
package main

// 导入系统包
import (
    "flag"
    "fmt"
)

// 定义命令行参数
var mode = flag.String("mode", "", "process mode")

func main() {

    // 解析命令行参数
    flag.Parse()

    // 输出命令行参数
    fmt.Println(*mode)
}
```

文件为main.go，控制台运行如下：

```go
go run main.go --mode=fast
```

输出结果：

```go
fast
```

分析：

<font style="color:rgb(68, 68, 68);">代码说明如下：</font>

+ <font style="color:rgb(68, 68, 68);">第 10 行，通过 flag.String，定义一个 mode 变量，这个变量的类型是 *string。后面 3 个参数分别如下：</font>
    - <font style="color:rgb(68, 68, 68);">参数名称：在命令行输入参数时，使用这个名称。</font>
    - <font style="color:rgb(68, 68, 68);">参数值的默认值：与 flag 所使用的函数创建变量类型对应，String 对应字符串、Int 对应整型、Bool 对应布尔型等。</font>
    - <font style="color:rgb(68, 68, 68);">参数说明：使用 -help 时，会出现在说明中。</font>
+ <font style="color:rgb(68, 68, 68);">第 15 行，解析命令行参数，并将结果写入到变量 mode 中。</font>
+ <font style="color:rgb(68, 68, 68);">第 18 行，打印 mode 指针所指向的变量。</font>



参考文章：

[http://c.biancheng.net/view/21.html](http://c.biancheng.net/view/21.html)



> 更新: 2021-11-14 17:11:07  
> 原文: <https://www.yuque.com/xiaoshan_wgo/codingnotes/iuzkdc>