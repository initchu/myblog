
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="è¤šæˆå¿—">
      
      
        <link rel="canonical" href="http://blog.chucz.asia/%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0/GoNotes/%E3%80%90Go%E3%80%91%E7%BC%96%E7%A8%8B%E6%A0%B8%E5%BF%83/12Channel%E7%AE%A1%E9%81%93%E6%9C%BA%E5%88%B6/">
      
      
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.23">
    
    
      
        <title>12 Channel ç®¡é“æœºåˆ¶ - è¤šæˆå¿—çš„æŠ€æœ¯åšå®¢</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#12-channel" class="md-skip">
          è·³è½¬è‡³
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="é¡µçœ‰">
    <a href="../../../.." title="è¤šæˆå¿—çš„æŠ€æœ¯åšå®¢" class="md-header__button md-logo" aria-label="è¤šæˆå¿—çš„æŠ€æœ¯åšå®¢" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            è¤šæˆå¿—çš„æŠ€æœ¯åšå®¢
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              12 Channel ç®¡é“æœºåˆ¶
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="æœç´¢" placeholder="æœç´¢" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="æŸ¥æ‰¾">
        
        <button type="reset" class="md-search__icon md-icon" title="æ¸…ç©ºå½“å‰å†…å®¹" aria-label="æ¸…ç©ºå½“å‰å†…å®¹" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            æ­£åœ¨åˆå§‹åŒ–æœç´¢å¼•æ“
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="å¯¼èˆªæ " data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="è¤šæˆå¿—çš„æŠ€æœ¯åšå®¢" class="md-nav__button md-logo" aria-label="è¤šæˆå¿—çš„æŠ€æœ¯åšå®¢" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    è¤šæˆå¿—çš„æŠ€æœ¯åšå®¢
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    é¦–é¡µ
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="ç›®å½•">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      ç›®å½•
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      éœ€æ±‚åœºæ™¯
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mutex" class="md-nav__link">
    <span class="md-ellipsis">
      å…¨å±€äº’æ–¥é”Mutexè§£å†³èµ„æºç«äº‰é—®é¢˜
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#channel" class="md-nav__link">
    <span class="md-ellipsis">
      Channelç®¡é“æœºåˆ¶è§£å†³èµ„æºäº‰å¤ºé—®é¢˜
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Channelç®¡é“æœºåˆ¶è§£å†³èµ„æºäº‰å¤ºé—®é¢˜">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#channel_1" class="md-nav__link">
    <span class="md-ellipsis">
      Channelçš„åŸºæœ¬ä»‹ç»
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      ç®¡é“çš„å®šä¹‰
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      ç®¡é“çš„ä½¿ç”¨
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      ç®¡é“çš„å…³é—­
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      ç®¡é“çš„éå†
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#goroutinechannel" class="md-nav__link">
    <span class="md-ellipsis">
      goroutineå’Œchannelç»“åˆ
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="12-channel">12 Channel ç®¡é“æœºåˆ¶<a class="headerlink" href="#12-channel" title="Permanent link">&para;</a></h1>
<h2 id="_1">éœ€æ±‚åœºæ™¯<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>å‡è®¾æœ‰è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼Œæƒ³è¦å°†åç¨‹å’Œä¸»çº¿ç¨‹è®¡ç®—åäº§ç”Ÿçš„æ•°æ®å­˜æ”¾åˆ°å…¨å±€çš„Mapä¸­ã€‚</p>
<p>ä¾‹å¦‚ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥è®¡ç®—å„ä¸ªæ•°çš„é˜¶ä¹˜ï¼Œå¹¶æ”¾å…¥åˆ°mapä¸­ï¼Œå¯åŠ¨äº†å¤šä¸ªåç¨‹è¿›è¡Œè®¡ç®—æœºï¼Œç»Ÿè®¡çš„ç»“æœæ”¾å…¥åˆ°mapä¸­ã€‚</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<span class="kd">var</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">myMap</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
<span class="p">)</span>
<span class="c1">//test è®¡ç®—n!</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">test</span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="kt">int</span><span class="p">){</span>
<span class="w">    </span><span class="nx">res</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">n</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">{</span>
<span class="w">        </span><span class="nx">res</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">i</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">myMap</span><span class="p">[</span><span class="nx">n</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">res</span>
<span class="p">}</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">(){</span>
<span class="w">    </span><span class="c1">//å¼€å¯å¤šä¸ªåç¨‹</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">200</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">{</span>
<span class="w">        </span><span class="k">go</span><span class="w"> </span><span class="nx">test</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="o">*</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="nx">v</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">myMap</span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;map[%d]=%d\n&quot;</span><span class="p">,</span><span class="nx">i</span><span class="p">,</span><span class="nx">v</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>è¿è¡Œç»“æœï¼Œå­˜å…¥ä¹‹åæ˜¯æ··ä¹±çš„ã€‚</p>
<p>å€¼å¾—è€ƒè™‘çš„æ˜¯ï¼Œéœ€è¦ä¿è¯ä¸åŒçš„åç¨‹ä¹‹é—´é¿å…å‡ºç°èµ„æºçš„äº‰å¤ºé—®é¢˜ã€‚</p>
<p>æœ‰ä¸¤ç§åŠæ³•å¯ä»¥è§£å†³ï¼Œç¬¬ä¸€ç§æ˜¯ä½¿ç”¨å…¨å±€äº’æ–¥é”æ¥è§£å†³ï¼Œç¬¬äºŒç§åŠæ³•æ˜¯ä½¿ç”¨ç®¡é“æœºåˆ¶ã€‚</p>
<h2 id="mutex">å…¨å±€äº’æ–¥é”Mutexè§£å†³èµ„æºç«äº‰é—®é¢˜<a class="headerlink" href="#mutex" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<span class="kd">var</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">myMap</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
<span class="w">    </span><span class="c1">//å£°æ˜ä¸€å…±å…¨å±€çš„äº’æ–¥é”lock</span>
<span class="w">    </span><span class="c1">//syncæ˜¯åŒ…ï¼Œå…¨æ‹¼&quot;synchornized&quot;æ˜¯åŒæ­¥çš„æ„æ€</span>
<span class="w">    </span><span class="c1">//Mutexæ˜¯äº’æ–¥çš„æ„æ€</span>
<span class="w">    </span><span class="nx">lock</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>
<span class="p">)</span>
<span class="c1">//test è®¡ç®—n!</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">test</span><span class="p">(</span><span class="nx">n</span><span class="w"> </span><span class="kt">int</span><span class="p">){</span>
<span class="w">    </span><span class="nx">res</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">n</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">{</span>
<span class="w">        </span><span class="nx">res</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="nx">i</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">//åŠ é”</span>
<span class="w">    </span><span class="nx">lock</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<span class="w">    </span><span class="nx">myMap</span><span class="p">[</span><span class="nx">n</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">res</span>
<span class="w">    </span><span class="c1">//å­˜å…¥ä¹‹åè§£é”</span>
<span class="w">    </span><span class="nx">lock</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
<span class="p">}</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">(){</span>
<span class="w">    </span><span class="c1">//å¼€å¯å¤šä¸ªåç¨‹</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">200</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">{</span>
<span class="w">        </span><span class="k">go</span><span class="w"> </span><span class="nx">test</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="o">*</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
<span class="w">    </span><span class="nx">lock</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="nx">v</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">myMap</span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;map[%d]=%d\n&quot;</span><span class="p">,</span><span class="nx">i</span><span class="p">,</span><span class="nx">v</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">lock</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>
<p>ä¸ºä»€ä¹ˆåœ¨ç¬¬28è¡Œä¹Ÿè¦åŠ ä¸€ä¸ªäº’æ–¥é”ï¼Ÿ</p>
<p>æŒ‰ç†è¯´åç§’é’Ÿä¹‹åä¸Šé¢çš„åç¨‹éƒ½åº”è¯¥æ‰§è¡Œå®Œæ¯•äº†ï¼Œåé¢çš„æ‰“å°å°±ä¸ä¼šå‡ºç°èµ„æºç«äº‰çš„é—®é¢˜äº†ã€‚åœ¨å®é™…çš„è¿è¡Œä¸­ï¼Œè¿˜æ˜¯å¯èƒ½åœ¨æ‰“å°éƒ¨åˆ†å‡ºç°èµ„æºç«äº‰é—®é¢˜ï¼Œå› ä¸ºè™½ç„¶æˆ‘ä»¬ä»ç¨‹åºè®¾è®¡ä¸Šå¯ä»¥çŸ¥é“10ç§’å°±å¯ä»¥æ‰§è¡Œå®Œæ‰€æœ‰çš„åç¨‹ï¼Œä½†æ˜¯ä¸»çº¿ç¨‹å¹¶ä¸çŸ¥é“ï¼Œå› æ­¤åº•å±‚ä»å¯èƒ½å‡ºç°èµ„æºäº‰å¤ºï¼Œè¿™é‡ŒåŠ å…¥äº’æ–¥é”å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ğŸ˜…</p>
<h2 id="channel">Channelç®¡é“æœºåˆ¶è§£å†³èµ„æºäº‰å¤ºé—®é¢˜<a class="headerlink" href="#channel" title="Permanent link">&para;</a></h2>
<p>å‰é¢ä½¿ç”¨å…¨å±€äº’æ–¥é”æ¥è§£å†³goroutineçš„é€šä¿¡å¹¶ä¸å®Œç¾ï¼Œè¿™æ˜¯å› ä¸ºï¼š</p>
<ul>
<li>ä¸»çº¿ç¨‹åœ¨ç­‰å¾…æ‰€æœ‰goroutineå…¨éƒ¨å®Œæˆçš„æ—¶é—´å¾ˆéš¾ç¡®å®š</li>
<li>å¦‚æœä¸»çº¿ç¨‹ä¼‘çœ æ—¶é—´é•¿äº†ï¼Œä¼šåŠ é•¿ç­‰å¾…æ—¶é—´ï¼Œå¦‚æœç­‰å¾…æ—¶é—´çŸ­äº†ï¼Œå¯èƒ½è¿˜æœ‰goroutineå¤„äºå·¥ä½œçŠ¶æ€ï¼Œè¿™æ—¶ä¹Ÿä¼šéšä¸»çº¿ç¨‹çš„é€€å‡ºè€Œé”€æ¯</li>
<li>é€šè¿‡å…¨å±€äº’æ–¥é”æ¥å®ç°é€šè®¯ï¼Œä¹Ÿæ²¡æœ‰åˆ©ç”¨å¤šä¸ªåç¨‹åŒæ—¶å¯¹å…¨å±€å˜é‡è¿›è¡Œè¯»å†™æ“ä½œ</li>
</ul>
<h3 id="channel_1">Channelçš„åŸºæœ¬ä»‹ç»<a class="headerlink" href="#channel_1" title="Permanent link">&para;</a></h3>
<ul>
<li>channelæœ¬è´¨æ˜¯ä¸€ä¸ªæ•°æ®ç»“æ„-é˜Ÿåˆ—</li>
<li>æ•°æ®æ˜¯å…ˆè¿›å…ˆå‡ºçš„</li>
<li>ç®¡é“å¯ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå¤šä¸ªåç¨‹è®¿é—®çš„æ—¶å€™ï¼Œä¸éœ€è¦åŠ é”ï¼Œchannelæœ¬èº«å°±æ˜¯çº¿ç¨‹å®‰å…¨çš„</li>
<li>channelæ˜¯ç”±ç±»å‹çš„ï¼Œä¸€ä¸ªstringçš„channelåªèƒ½å­˜æ”¾stringç±»å‹çš„æ•°æ®</li>
</ul>
<h3 id="_2">ç®¡é“çš„å®šä¹‰<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">intChan</span><span class="w"> </span><span class="kd">chan</span><span class="w"> </span><span class="kt">int</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">mapChan</span><span class="w"> </span><span class="kd">chan</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kt">string</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">perChan</span><span class="w"> </span><span class="kd">chan</span><span class="w"> </span><span class="nx">Person</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">perChan2</span><span class="w"> </span><span class="kd">chan</span><span class="w"> </span><span class="o">*</span><span class="nx">Person</span>
</code></pre></div>
<p>ç®¡é“æ˜¯å¼•ç”¨ç±»å‹</p>
<p><code>channel</code>å¿…é¡»åˆå§‹åŒ–æ‰èƒ½å†™å…¥æ•°æ®ï¼Œå³<code>make</code>åæ‰èƒ½ä½¿ç”¨ã€‚</p>
<p>ç®¡é“æ˜¯ç”±ç±»å‹çš„ï¼Œ<code>intChan</code>åªèƒ½å†™å…¥æ•´æ•°<code>int</code></p>
<h3 id="_3">ç®¡é“çš„ä½¿ç”¨<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">(){</span>
<span class="w">    </span><span class="c1">//1.åˆ›å»ºä¸€å…±å¯ä»¥å­˜æ”¾3ä¸ªintç±»å‹çš„ç®¡é“</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">intChan</span><span class="w"> </span><span class="kd">chan</span><span class="w"> </span><span class="kt">int</span>
<span class="w">    </span><span class="nx">intChan</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
<span class="w">    </span><span class="c1">//2.æŸ¥çœ‹intChanæ˜¯ä»€ä¹ˆ</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;intChançš„å€¼ = %v,intChanæœ¬èº«çš„åœ°å€ = %p\n&quot;</span><span class="p">,</span><span class="nx">intChan</span><span class="p">,</span><span class="o">&amp;</span><span class="nx">intChan</span><span class="p">)</span><span class="w"> </span><span class="c1">//å€¼å°±æ˜¯ä¸€ä¸ªåœ°å€</span>
<span class="w">    </span><span class="c1">//3.å‘ç®¡é“å†™å…¥æ•°æ®</span>
<span class="w">    </span><span class="nx">intChan</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="mi">10</span>
<span class="w">    </span><span class="nx">num</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">211</span>
<span class="w">    </span><span class="nx">intChan</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">num</span>
<span class="w">    </span><span class="nx">intChan</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span>
<span class="w">    </span><span class="c1">//ç»™ç®¡é“å†™å…¥æ•°æ®çš„æ—¶å€™ï¼Œä¸èƒ½è¶…è¿‡å…¶å®¹é‡</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;channel len = %v cap = %v \n&quot;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="nx">intChan</span><span class="p">),</span><span class="nb">cap</span><span class="p">(</span><span class="nx">intChan</span><span class="p">))</span><span class="c1">//3ï¼Œ3</span>
<span class="w">    </span><span class="c1">//3.ä»ç®¡é“ä¸­è¯»å–æ•°æ®</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">num2</span><span class="w"> </span><span class="kt">int</span>
<span class="w">    </span><span class="nx">num2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">intChan</span><span class="w"> </span><span class="c1">//ç®¡é“çš„æ•°æ®æ¨ç»™äº†num2,å…ˆè¿›å…ˆå‡º</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;num2 = &quot;</span><span class="p">,</span><span class="nx">num2</span><span class="p">)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;channel len = %v cap = %v \n&quot;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="nx">intChan</span><span class="p">),</span><span class="nb">cap</span><span class="p">(</span><span class="nx">intChan</span><span class="p">))</span><span class="w"> </span><span class="c1">//2,3</span>
<span class="w">    </span><span class="c1">//6.åœ¨æ²¡æœ‰ä½¿ç”¨åç¨‹çš„æƒ…å†µä¸‹ï¼Œå¦‚æœæˆ‘ä»¬çš„ç®¡é“æ•°æ®å·²ç»å…¨éƒ¨å–å‡ºï¼Œå†å–å°±ä¼šæŠ¥å‘Šdeadkockæ­»é”,é˜»å¡</span>
<span class="w">    </span><span class="nx">num3</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">intChan</span><span class="w"> </span><span class="c1">//211</span>
<span class="w">    </span><span class="nx">num4</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">intChan</span><span class="w"> </span><span class="c1">//50</span>
<span class="w">    </span><span class="nx">num5</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">intChan</span><span class="w"> </span><span class="c1">//deadlock</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;num3 =&quot;</span><span class="p">,</span><span class="nx">num3</span><span class="w"> </span><span class="p">,</span><span class="s">&quot;num4 = &quot;</span><span class="p">,</span><span class="nx">num4</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;num5 = &quot;</span><span class="p">,</span><span class="nx">num5</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>æ€»ç»“ï¼š</p>
<ul>
<li>channelä¸­åªèƒ½å­˜æ”¾<strong>æŒ‡å®š</strong>çš„æ•°æ®ç±»å‹</li>
<li>channelçš„æ•°æ®æ”¾æ»¡äº†ä¹‹åï¼Œå°±ä¸èƒ½å†æ”¾å…¥äº†</li>
<li>å¦‚æœä»channelå–å‡ºæ•°æ®åï¼Œå¯ä»¥ç»§ç»­æ”¾å…¥</li>
<li>åœ¨æ²¡æœ‰ä½¿ç”¨åç¨‹çš„æƒ…å†µä¸‹ï¼Œå¦‚æœchannelæ•°æ®å–å®Œäº†ï¼Œå†å–ï¼Œå°±ä¼šæŠ¥å‘Šdeadlock</li>
</ul>
<p>ç®¡é“çš„ä½¿ç”¨æ³¨æ„äº‹é¡¹ï¼š</p>
<p><strong>åªèƒ½å­˜æ”¾æŒ‡å®šçš„æ•°æ®ç±»å‹ä¹‹ç©ºæ¥å£ï¼</strong></p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Cat</span><span class="w"> </span><span class="kd">struct</span><span class="p">{</span>
<span class="w">    </span><span class="nx">Name</span><span class="w"> </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">Age</span><span class="w"> </span><span class="kt">int</span>
<span class="p">}</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">(){</span>
<span class="w">    </span><span class="c1">//å®šä¹‰ä¸€ä¸ªå­˜æ”¾ä»»æ„æ•°æ®ç±»å‹çš„ç®¡é“ï¼Œ3ä¸ªæ•°æ®</span>
<span class="w">    </span><span class="nx">a11Chan</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="kd">interface</span><span class="p">{},</span><span class="mi">3</span><span class="p">)</span>
<span class="w">    </span><span class="nx">a11Chan</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="mi">10</span>
<span class="w">    </span><span class="nx">a11Chan</span><span class="w"> </span><span class="o">&lt;-</span><span class="s">&quot;tom jack&quot;</span>
<span class="w">    </span><span class="nx">cat</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">Cat</span><span class="p">{</span><span class="s">&quot;å°èŠ±çŒ«&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">}</span>
<span class="w">    </span><span class="nx">a11Chan</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nx">cat</span>
<span class="w">    </span><span class="c1">//æˆ‘ä»¬å¸Œæœ›è·å–åˆ°ç®¡é“ä¸­çš„ç¬¬ä¸‰ä¸ªå…ƒç´ ï¼Œåˆ™å…ˆå°†å‰ä¸¤ä¸ªæ¨å‡º</span>
<span class="w">    </span><span class="o">&lt;-</span><span class="nx">a11Chan</span>
<span class="w">    </span><span class="o">&lt;-</span><span class="nx">a11Chan</span>
<span class="w">    </span><span class="nx">newCat</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">allChan</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;newCat type = %T&quot;</span><span class="p">,</span><span class="nx">newCat</span><span class="p">)</span><span class="w"> </span><span class="c1">//</span>
<span class="w">    </span><span class="c1">//è½¬ä¸€ä¸‹ç±»å‹æ–­è¨€ </span>
<span class="w">    </span><span class="c1">//a := newCat.(cat)</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;newCat.Name= %v&quot;</span><span class="p">,</span><span class="nx">newCat</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span><span class="c1">//å¦‚æœæ²¡æœ‰ç±»å‹æ–­è¨€æ˜¯æŠ¥é”™çš„ï¼Œç®¡é“å­˜æ”¾çš„æ˜¯ç©ºæ¥å£ï¼Œé‡Œé¢æ˜¯æ²¡æœ‰å­—æ®µå’Œæ–¹æ³•çš„</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="_4">ç®¡é“çš„å…³é—­<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p>ä½¿ç”¨å†…ç½®å‡½æ•°closeå¯ä»¥å…³é—­channelï¼Œå½“channelå…³é—­åï¼Œå°±ä¸èƒ½å†å‘channelå†™å…¥æ•°æ®äº†ï¼Œä½†æ˜¯ä»ç„¶å¯ä»¥ä»è¯¥channelè¯»å–æ•°æ®ã€‚</p>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">(){</span>
<span class="w">    </span><span class="nx">intChan</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
<span class="w">    </span><span class="nx">intChan</span><span class="o">&lt;-</span><span class="w"> </span><span class="mi">100</span>
<span class="w">    </span><span class="nx">intChan</span><span class="o">&lt;-</span><span class="w"> </span><span class="mi">200</span>
<span class="w">    </span><span class="nb">close</span><span class="p">(</span><span class="nx">intChan</span><span class="p">)</span><span class="c1">//å…³é—­channel</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;è¿è¡ŒæˆåŠŸ&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="c1">//è¯»å–æ•°æ®</span>
<span class="w">    </span><span class="nx">n1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">intChan</span>
<span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;n1=&quot;</span><span class="p">,</span><span class="nx">n1</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="_5">ç®¡é“çš„éå†<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p>channelä¸èƒ½ä½¿ç”¨æ™®é€šçš„éå†å¾ªç¯ã€‚</p>
<p>channelæ”¯æŒ<code>for - range</code>çš„æ–¹å¼è¿›è¡Œéå†ï¼š</p>
<ul>
<li>åœ¨éå†çš„æ—¶å€™ï¼Œå¦‚æœchannelæ²¡æœ‰å…³é—­ï¼Œåˆ™ä¼šå‡ºç°<code>deadlock</code>çš„é”™è¯¯</li>
<li>åœ¨éå†çš„æ—¶å€™ï¼Œå¦‚æœchannelå·²ç»å…³é—­ï¼Œåˆ™ä¼šæ­£å¸¸éå†æ•°æ®ï¼Œéå†å®Œä¹‹åï¼Œå°±ä¼šé€€å‡ºéå† </li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">(){</span>
<span class="w">    </span><span class="nx">intChan</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="p">&lt;</span><span class="mi">100</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">{</span>
<span class="w">        </span><span class="nx">intChan</span><span class="o">&lt;-</span><span class="w"> </span><span class="nx">i</span><span class="o">*</span><span class="mi">2</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span>
<span class="w">    </span><span class="c1">//Close(intChan)</span>
<span class="w">    </span><span class="c1">//å¦‚æœç®¡é“æ²¡æœ‰å…³é—­ï¼Œåˆ™åœ¨è¯»å–ç»“æŸåï¼Œå‡ºç°æ­»é”çš„é”™è¯¯</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">v</span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">intChan</span><span class="p">{</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;v=&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>æ³¨æ„âŒï¼šéå†ç®¡é“çš„æ—¶å€™ä¸èƒ½ä½¿ç”¨æ™®é€šçš„<code>for</code>å¾ªç¯ï¼š<code>&lt;font style="color:#E8323C;"&gt;for i := 0; i &lt; len(intChan); i++{}&lt;/font&gt;</code></p>
<h2 id="goroutinechannel">goroutineå’Œchannelç»“åˆ<a class="headerlink" href="#goroutinechannel" title="Permanent link">&para;</a></h2>
<p>åœ¨ä¸€ä¸ªç®¡é“ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å®ç°ä»¥ä¸‹è¦æ±‚ï¼š</p>
<ul>
<li>å¼€å¯ä¸€ä¸ªwriteDataåç¨‹ï¼Œå‘ç®¡é“intChanä¸­å†™å…¥50ä¸ªæ•´æ•°ã€‚</li>
<li>å¼€å¯ä¸€ä¸ªreadDataåç¨‹ï¼Œä»ç®¡é“ä¸­è¯»å–writeDataå†™å…¥çš„æ•°æ®ã€‚</li>
<li>ä¸»çº¿ç¨‹éœ€è¦ç­‰å¾…writeDataå’ŒreadDataåç¨‹éƒ½å®Œæˆå·¥ä½œæ‰èƒ½é€€å‡ºã€‚</li>
</ul>
<p>è®¾è®¡æ€è·¯æ˜¯ï¼š</p>
<p>å¼€å¯ä¸¤ä¸ª<strong>åç¨‹ï¼ˆè¯»å’Œå†™ï¼‰</strong>åŒæ—¶æ‰§è¡Œï¼ŒåŒæ—¶ä½¿ç”¨ä¸¤ä¸ª<strong>ç®¡é“</strong>ï¼Œå…¶ä¸­ä¸€ä¸ªç®¡é“<code>intChan</code>ç”¨æ¥å­˜æ”¾æ•°æ®ï¼Œå½“<strong>è¯»åç¨‹</strong>æ‰§è¡Œè¯»å®Œï¼Œå‘å¦ä¸€ä¸ªç®¡é“<code>exitChan</code>ä¸­å†™å…¥ä¸€ä¸ª<code>true</code>ï¼Œå¹¶å…³é—­ç¬¬äºŒä¸ªç®¡é“ã€‚è®¾ç½®ç¬¬äºŒä¸ªç®¡é“çš„åŸå› æ˜¯ï¼Œå½“å¼€å¯åç¨‹ä¹‹åï¼Œä¸»çº¿ç¨‹ä»æ—§å¾€ä¸‹æ‰§è¡Œï¼Œè®¾ç½®ä¸€ä¸ªæŒç»­è¯»å–çš„å¾ªç¯ï¼Œç›´åˆ°è¯»å–åˆ°äº†<code>eixtChan</code>é‡Œé¢çš„<code>true</code>ï¼Œå°±è¯æ˜äº†è¿™ä¸¤ä¸ªåç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œä¹Ÿå°±æ˜¯ä¿è¯äº†â€œä¸»çº¿ç¨‹éœ€è¦ç­‰å¾…writeDataå’ŒreadDataåç¨‹éƒ½å®Œæˆå·¥ä½œæ‰èƒ½é€€å‡ºâ€è¿™ä¸€ä¸ªæ¡ä»¶ã€‚</p>
<div class="highlight"><pre><span></span><code><span class="w"> </span><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<span class="c1">//writeData å†™æ•°æ®</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">writeData</span><span class="p">(</span><span class="nx">intChane</span><span class="w"> </span><span class="kd">chan</span><span class="w"> </span><span class="kt">int</span><span class="p">){</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">50</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">{</span>
<span class="w">        </span><span class="c1">//æ”¾å…¥æ•°æ®</span>
<span class="w">        </span><span class="nx">intChan</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nx">i</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;writeData&quot;</span><span class="p">,</span><span class="nx">i</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nb">close</span><span class="p">(</span><span class="nx">intChan</span><span class="p">)</span><span class="c1">//å…³é—­</span>
<span class="p">}</span>
<span class="c1">// readData è¯»æ•°æ®</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">readData</span><span class="p">(</span><span class="nx">intChan</span><span class="w"> </span><span class="kd">chan</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">exitChan</span><span class="w"> </span><span class="kd">chan</span><span class="w"> </span><span class="kt">bool</span><span class="p">){</span>
<span class="w">    </span><span class="k">for</span><span class="p">{</span>
<span class="w">        </span><span class="nx">v</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">intChan</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">ok</span><span class="p">{</span>
<span class="w">            </span><span class="k">break</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;readData = %v\n&quot;</span><span class="p">,</span><span class="nx">v</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">exitChan</span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="nb">close</span><span class="p">(</span><span class="nx">exitChan</span><span class="p">)</span><span class="c1">//è¯»å®Œæ•°æ®å…³é—­ç®¡é“</span>
<span class="p">}</span>
<span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">(){</span>
<span class="w">    </span><span class="c1">//åˆ›å»ºä¸¤ä¸ªç®¡é“</span>
<span class="w">    </span><span class="nx">intChan</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">)</span>
<span class="w">    </span><span class="nx">exitChan</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">chan</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="nx">writeData</span><span class="p">(</span><span class="nx">intChan</span><span class="p">)</span>
<span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="nx">readData</span><span class="p">(</span><span class="nx">intChan</span><span class="p">,</span><span class="w"> </span><span class="nx">exitChan</span><span class="p">)</span>
<span class="w">    </span><span class="k">for</span><span class="p">{</span><span class="w"> </span><span class="c1">//é˜²æ­¢ä¸»çº¿ç¨‹é€€å‡ºï¼Œä¸€ç›´è¯»exitChanç®¡é“,è¯»åˆ°äº†å°±é€€å‡º </span>
<span class="w">        </span><span class="nx">_</span><span class="p">,</span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">exitChan</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">ok</span><span class="p">{</span>
<span class="w">            </span><span class="k">break</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>â—</strong><strong> æ³¨æ„ï¼šå¦‚æœç¼–è¯‘å™¨å‘ç°åªå‘ç®¡é“å†™å…¥æ•°æ®ï¼Œè€Œæ²¡æœ‰è¯»å–ï¼Œåˆ™ä¼šå‡ºç°</strong><code>**deadlock**</code><strong>ï¼ŒåŸå› å‘ç”Ÿäº†é˜»å¡ï¼Œ</strong><code>**intChan**</code><strong>å®¹é‡æ˜¯10ï¼Œè€Œä»£ç writeDataä¼šå†™å…¥50ä¸ªæ•°æ®ï¼Œå› æ­¤ä¼šé˜»å¡åœ¨writeDataçš„</strong><code>**ch &lt;- i**</code><strong> ã€‚</strong></p>
<blockquote>
<p>æ›´æ–°: 2022-02-21 13:46:51<br />
åŸæ–‡: <a href="https://www.yuque.com/xiaoshan_wgo/codingnotes/ptkuec">https://www.yuque.com/xiaoshan_wgo/codingnotes/ptkuec</a></p>
</blockquote>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": [], "search": "../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>